extends layout

block content
    h1 Admin Panel - User Management

    table
        tr
            th Username
            th Role
            th Actions
        each user, index in users
            tr
                td= user.username
                td
                    div(roleContainerId=`role-container-${index}`)
                        // Display the current role by default
                        span(id=`role-span-${index}` class="role-display")= user.role
                        // Role edit form (hidden by default)
                        form(action=`/admin/edit-role/${user.id}` method="POST" id=`edit-role-form-${index}` class="form-inline" style="display:none; margin:0;")
                            select(name="role" required)
                                option(value="admin" selected=user.role === 'admin') Admin
                                option(value="redaktionsMedlem" selected=user.role === 'redaktionsMedlem') Redaktions Medlem
                                option(value="medlemsOrganisation" selected=user.role === 'medlemsOrganisation') Medlems Organisation
                            button(type="submit" class="button-save") Save
                td.actions
                    button(type="button" class="button-edit" onclick=`toggleEditRole(${index})`) Edit
                    a.button-delete(href=`/admin/delete/${user.id}` onclick="return confirmDelete()") Delete

    h2 Add New User
    form(action="/admin/add" method="POST" class="form-container")
        label(for="username") Username:
        input(type="text" name="username" required)

        label(for="password") Password:
        input(type="password" name="password" required)

        label(for="role") Role:
        select(name="role" required)
            option(value="admin") Admin
            option(value="redaktionsMedlem") Redaktions Medlem
            option(value="medlemsOrganisation") Medlems Organisation

        button(type="submit") Add User

    script.
        function confirmDelete() {
            return confirm('Are you sure you want to delete this user?');
        }

        function toggleEditRole(index) {
            const roleSpan = document.getElementById(`role-span-${index}`);
            const editForm = document.getElementById(`edit-role-form-${index}`);

            if (editForm.style.display === "none") {
                // Hide the current role text and show the edit form
                roleSpan.style.display = "none";
                editForm.style.display = "inline-flex";
            } else {
                // Show the current role text and hide the edit form
                roleSpan.style.display = "inline";
                editForm.style.display = "none";
            }
        }
