extends layout

block content
    h1 Admin Panel - User Management

    table
        tr
            th Name
            th Email
            th Role
            th Signup Status
            th Actions
        each user, index in users
            tr
                td= user.name
                td= user.email
                td
                    div(roleContainerId=`role-container-${index}` class="role-container")
                        // Display the current role by default
                        span(id=`role-span-${index}` class="role-display")= user.role
                        // Role edit form (hidden by default)
                        form(action=`/admin/edit-role/${user.id}` method="POST" id=`edit-role-form-${index}` class="form-inline role-edit-form" style="display:none; margin:0;")
                            select(name="role" required)
                                option(value="admin" selected=user.role === 'admin') Admin
                                option(value="redaktionsMedlem" selected=user.role === 'redaktionsMedlem') Redaktions Medlem
                                option(value="medlemsOrganisation" selected=user.role === 'medlemsOrganisation') Medlems Organisation
                            button(type="submit" class="button-save") Save
                td= user.signup_status
                td.actions
                    button(type="button" class="button-edit" onclick=`toggleEditRole(${index})`) Edit
                    a.button-delete(href=`/admin/delete/${user.id}` onclick="return confirmDelete()") Delete


    h2 Send Invitation
        form(action="/admin/invite" method="POST" class="form-container")
            label(for="name") Username:
            input(type="text" name="name" required)

            label(for="organisation") Organisation:
            select(name="organisation_id" required)
                each organisation in organisations
                    option(value=organisation.id) #{organisation.name} - #{organisation.university}

            label(for="email") Email:
            input(type="email" name="email" required)

            label(for="role") Role:
            select(name="role" required)
                option(value="admin") Admin
                option(value="redaktionsMedlem") Redaktions Medlem
                option(value="medlemsOrganisation") Medlems Organisation

            button(type="submit") Send Invitation

    script.
        function confirmDelete() {
            return confirm('Are you sure you want to delete this user?');
        }

        function toggleEditRole(index) {
            const roleSpan = document.getElementById(`role-span-${index}`);
            const editForm = document.getElementById(`edit-role-form-${index}`);

            if (editForm.style.display === "none") {
                // Hide the current role text and show the edit form
                roleSpan.style.display = "none";
                editForm.style.display = "inline-flex";
            } else {
                // Show the current role text and hide the edit form
                roleSpan.style.display = "inline";
                editForm.style.display = "none";
            }
        }
